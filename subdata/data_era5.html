
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>The ERA-5 reanalysis: IRData.era5 &#8212; An API for accessing synoptic-timescale reanalyis data</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="The CERA-20C reanalysis: IRData.cera20c" href="data_cera20c.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="data_cera20c.html" title="The CERA-20C reanalysis: IRData.cera20c"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">IRData</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/UK.GS1987.png" alt="Logo"/>
            </a></p>
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_20CR.html">The 20th Century Reanalysis: IRData.twcr</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_cera20c.html">The CERA-20C reanalysis: IRData.cera20c</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The ERA-5 reanalysis: IRData.era5</a></li>
</ul>
<h3><a href="https://github.com/philip-brohan/IRData">Get the source code</a></h3>

<a href="https://github.com/philip-brohan/IRData"
           rel="nofollow">Github source repository</a>

<h3>Found a bug, or have a suggestion?</h3>

Please <a href="https://github.com/philip-brohan/IRData/issues/new">raise an issue</a>.
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-IRData.era5">
<span id="the-era-5-reanalysis-irdata-era5"></span><h1>The ERA-5 reanalysis: IRData.era5<a class="headerlink" href="#module-IRData.era5" title="Permalink to this headline">¶</a></h1>
<p>This package retrieves and loads data from the <a class="reference external" href="https://www.ecmwf.int/en/forecasts/datasets/reanalysis-datasets/era5">ERA5 reanalysis</a>.</p>
<p>To retrieve the data, it uses the <a class="reference external" href="https://software.ecmwf.int/wiki/display/WEBAPI/ECMWF+Web+API+Home">ECMWF Public data API</a>. You will need to install a key as described in <a class="reference external" href="https://software.ecmwf.int/wiki/display/WEBAPI/Access+ECMWF+Public+Datasets">the API documentation</a>. Note that this is the same system used by <cite>IRData.cera20c</cite> - the same key will let you use that as well.</p>
<p>Only hourly data is supported (no daily or monthly averages) for 7 surface variables:</p>
<ul class="simple">
<li>Mean-sea-level pressure: ‘mslp’</li>
<li>2m air temperature: ‘air.2m’</li>
<li>Precipitation rate: ‘prate’</li>
<li>10m meridional wind: ‘uwnd.10m’</li>
<li>10m zonal wind: ‘vwnd.10m’</li>
<li>Sea-surface temperature: ‘sst’</li>
<li>Sea-ice coverage: ‘icec’</li>
</ul>
<p>Data retrieved is stored in directory $SCRATCH/ERA5 - the ‘SCRATCH’ environment variable must be set. ERA 5 comes in two streams: the ‘oper’ stream is a single member analysis at highest resolution, and the ‘enda’ stream is a 10-member ensemble at lower resolution - both are supported.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">IRData.era5</span> <span class="kn">as</span> <span class="nn">era5</span>
<span class="n">era5</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;prate&#39;</span><span class="p">,</span>
           <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
           <span class="n">stream</span><span class="o">=</span><span class="s1">&#39;enda&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>will retrieve precipitation rate data for the selected date. ERA5 data is fetched in one-calendar-month blocks, so this will retrieve data for the whole of March 2015. The retrieval is slow, as the data has to be fetched from MARS at ECMWF, but the retrieval is only run if necessary - if that month’s data has been previously fetched and is already on local disc, the fetch command will detect this and return instantly.</p>
<p>Once the data has been fetched,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span><span class="o">=</span><span class="n">era5</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;prate&#39;</span><span class="p">,</span>
             <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1969</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span>
             <span class="n">stream</span><span class="o">=</span><span class="s1">&#39;enda&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>will then load the precipitation rates at quarter past 3pm on March 12 2015 from the retrieved dataset as a <a class="reference external" href="https://scitools.org.uk/iris/docs/latest/iris/iris/cube.html#iris.cube.Cube" title="(in Iris v2.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">iris.cube.Cube</span></code></a>. Note that as ERA5 only provides data at hourly or 3-hourly intervals, the value for 3:15pm will be interpolated between the outputs. Also, as ERA5 stream ‘enda’ is an ensemble dataset, the result will include all 10 ensemble members.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="function">
<dt id="IRData.era5.fetch">
<code class="descclassname">IRData.era5.</code><code class="descname">fetch</code><span class="sig-paren">(</span><em>variable</em>, <em>dtime</em>, <em>stream='enda'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/IRData/era5/fetch.html#fetch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IRData.era5.fetch" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all data for one variable, for one month, from ECMWF’s archive.</p>
<p>Data wil be stored locally in directory $SCRATCH/ERA5, to be retrieved by <a class="reference internal" href="#IRData.era5.load" title="IRData.era5.load"><code class="xref py py-func docutils literal notranslate"><span class="pre">load()</span></code></a>. If the local file that would be produced already exists, this function does nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>variable</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Variable to fetch (e.g. ‘prmsl’).</li>
<li><strong>dtime</strong> (<a class="reference external" href="https://docs.python.org/2/library/datetime.html#datetime.datetime" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a>) – Date and time to get data for.</li>
<li><strong>month</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>) – Month to get data for (1-12).</li>
<li><strong>stream</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Analysis stream to use, can be ‘enda’ - ensemble DA, or ‘oper’ - high res single member.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Will retrieve the data for the year and month of the given date-time. If the selected time is very close to the end of the calendar month, loading data for that time will also need data from the next calendar month (for interpolation). In this case, also fetch the data for the next calendar month.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><code class="xref py py-exc docutils literal notranslate"><span class="pre">StandardError</span></code> – If variable is not a supported value.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</dd></dl>

<dl class="function">
<dt id="IRData.era5.load">
<code class="descclassname">IRData.era5.</code><code class="descname">load</code><span class="sig-paren">(</span><em>variable</em>, <em>dtime</em>, <em>stream='enda'</em>, <em>fc_init=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/IRData/era5/load.html#load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#IRData.era5.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load requested data from disc, interpolating if necessary.</p>
<p>Data must be available in directory $SCRATCH/ERA5, previously retrieved by <a class="reference internal" href="#IRData.era5.fetch" title="IRData.era5.fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">fetch()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>variable</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#str" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>) – Variable to fetch (e.g. ‘prmsl’)</li>
<li><strong>dtime</strong> (<a class="reference external" href="https://docs.python.org/2/library/datetime.html#datetime.datetime" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">datetime.datetime</span></code></a>) – Date and time to load data for.</li>
<li><strong>fc_init</strong> (<a class="reference external" href="https://docs.python.org/2/library/functions.html#int" title="(in Python v2.7)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>) – If not None; 6 or 18. See below.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Global field of variable at time.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://scitools.org.uk/iris/docs/latest/iris/iris/cube.html#iris.cube.Cube" title="(in Iris v2.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">iris.cube.Cube</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Note that ERA5 data is only output every 3 hours (enda) or hour (oper), so if hour%3!=0, the result may be linearly interpolated in time.</p>
<p>Precipitation data in ERA5 is a forecast field: twice a day (at 06:00 and 18:00) forecast data is calculated for the next 18 hours. So at 21:00, for example, there are 2 sets of precipitation available: a 3-hour forecast starting at 18 that day, and a 15-hour forecast starting at 06:00, and there is a discontinuity between the two fields. This function will always load the shortest lead-time forecast available unless fc_init is set (to 6 or 18) in which case it will load the forecast starting at the hour specified. You will only need this if you are making videos, or otherwise need time-continuous forecast fields, in which case you will need to be clever in smoothing over the discontinuity. For analysis fields (everything except prate), this issue does not arise and fc_init is ignored.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><code class="xref py py-exc docutils literal notranslate"><span class="pre">StandardError</span></code> – Data not on disc - see <a class="reference internal" href="#IRData.era5.fetch" title="IRData.era5.fetch"><code class="xref py py-func docutils literal notranslate"><span class="pre">fetch()</span></code></a></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="data_cera20c.html" title="The CERA-20C reanalysis: IRData.cera20c"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">IRData</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>